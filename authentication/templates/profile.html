{% extends "base.html" %}
{% block content %}
{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}
<div class="bg-dark p-3">
	<div class="container-lg my-2">
		<!-- Settings for logged in users -->
		{% if request.user.username == user.username %}
		<a href="{% url 'user_settings' username=user.username %}" class="neon-button">Your Settings</a>
		{% endif %}
		<!-- User Info -->
		<div class="d-flex flex-column align-items-center">
			<div class="pt-5 d-flex md-rows align-items-center w-100 max-w-75">
				{% if user.profile_pic and user.profile_pic.url != "/img/False" %}
				<img src="{{ user.profile_pic.url }}" alt="Profile Picture" class="profile-pic bg-light rounded-circle">
				{% else %}
				<img src="{% static 'img/default.png' %}" alt="Profile Picture" class="profile-pic bg-light rounded-circle">
				{% endif %}
				<div class="bg-light text-dark w-75 p-2 m-3 text-center">
					<h1>{{ user.username }}</h1>
					<p>{{ user.bio }}</p>
				</div>
			</div>
			<div class="d-flex justify-content-center">
				<p class="bg-hl p-2 m-0">Member since: {{ user.created_on }}</p>
			</div>
			<div class="d-flex flex-row justify-content-center align-items-center py-2">
				<img src="{% static 'img/icons/star.svg' %}" alt="star" class="icon">
				{% if total_votes %}
				<p class="m-0 p-0 text-white px-2">{{ total_votes }}</p>
				{% else %}
				<p class="m-0 p-0 text-white px-2">Collected Upvotes: 0</p>
				{% endif %}
			</div>
		</div>
		<!-- END User Info -->
	</div>
</div>
<div class="d-flex flex-column bg-hl-pink h-100">
	<div class="container-lg p-3 h-100">
		<!-- Title -->
		<div class="bg-dark p-2 mb-2">
			{% if request.user.username == user.username %}
			<h2 class="text-white">All your Threads:</h2>
			{% else %}
			<h2 class="text-white">All Threads from {{user.username}}:</h2>
			{% endif %}
		</div>
		<!-- Users Treads -->
		{% if user.posts.all %}
		{% for thread in user.posts.all %}
		<div class="card m-2 p-2 d-flex flex-row">
			<div class="d-flex flex-column align-items-center">
				<!-- Voting -->
				<form action="{% url 'upvote_thread' thread_id=thread.id %}" method="post">
					{% csrf_token %}
					<button type="submit" class="rm-btn"><img src="{% static 'img/icons/up.svg' %}" alt="upvote" class="icon m-2 {% if request.user.is_authenticated and thread.has_upvoted %}circle bg-yellow{% endif %}"></button>
				</form>
				<p class="circle text-light bg-hl-pink m-0">{{ thread.votes }}</p>
				<form action="{% url 'downvote_thread' thread_id=thread.id %}" method="post">
					{% csrf_token %}
					<button type="submit" class="rm-btn"><img src="{% static 'img/icons/up.svg' %}" alt="downvote" class="icon m-2 rotate-180 {% if request.user.is_authenticated and thread.has_downvoted %}circle bg-yellow{% endif %}"></button>
				</form>
				<!-- Tags -->
				{% for tag in thread.tags.all %}
				<a href="{% url 'tag_site' slug=tag.slug %}">
					<p class="tag">{{ tag }}</p>
				</a>
				{% endfor %}
			</div>
			<!-- Thread Body -->
			<div class="card-body d-flex flex-column">
				<h2 class="text-break"><a href="{% url 'thread_detail' thread_id=thread.id slug=thread.slug %}" class="card-title text-break">{{ thread.title }}</a></h2>
				<div class="d-flex flex-row justify-content-between">
					<p class="fs-7">by <a href="{% url 'user_profile' username=thread.author %}" class="link">{{ thread.author }}</a></p>
					<p class="card-text text-muted fs-7">{{ thread.created_on}}
				</div>
				<p class="card-text text-break">{{ thread.content|truncatechars:500 }}</p>
				<a href="{% url 'thread_detail' thread_id=thread.id slug=thread.slug %}" class="neon-button align-self-end">Full thread</a>
			</div>
		</div>
		{% endfor %}
		{% else %}
		<p>No threads available for this user.</p>
		{% endif %}
		<!-- END User Threads -->
	</div>
</div>
{% endblock %}